# 小区设备维修平台 - 数据库设计 (V1.0)

**文档版本:** 1.0 **设计日期:** 2025年10月17日

## 1. 数据表总览 (Table Overview)

本项目核心包含四张数据表：

- **User (用户表):** 存储业主和管理员的基本信息。
- **RepairOrder (报修单表):** 存储所有报修单的核心信息。
- **Evaluation (评价表):** 存储业主对已完成工单的评价。
- **Favorite (收藏表):** 存储管理员收藏的工单关系。

## 2. 数据表结构详情 (Table Schemas)

### 2.1. `User` - 用户表

存储系统中的所有用户。


| **字段名 (Field)** | **类型 (Type)** | **约束 (Constraints)** | **描述** | | `id` | `Int` | Primary Key, Auto-increment | 唯一ID | | `username` | `String` | Unique | 用户名 | | `password` | `String` |  | 加密后的密码哈希 | | `role` | `Enum` | `RESIDENT`, `ADMIN` | 用户角色 | | `createdAt` | `DateTime` | Default `now()` | 创建时间 |

### 2.2. `RepairOrder` - 报修单表

这是最核心的业务表，记录了报修单的全部信息。

| **字段名 (Field)** | **类型 (Type)** | **约束 (Constraints)** | **描述** | | `id` | `Int` | Primary Key, Auto-increment | 唯一ID | | `title` | `String` |  | 报修单标题 | | `description` | `String` | Nullable | 问题详细描述 | | `address` | `String` |  | 维修地址 | | `images` | `String[]` |  | 业主上传的图片URL列表 | | `status` | `Enum` | `PENDING`, `PROCESSING`, `COMPLETED`, `CANCELED`, `CANCELLATION_REQUESTED` | 工单状态 | | `priority` | `Enum` | Nullable (`P0`, `P1`, `P2`) | 工单优先级, 默认为空 | | `cancellationReason` | `String` | Nullable | 管理员请求撤销时填写的原因 | | `assignedCompany` | `String` | Nullable | 被指派的维修公司 | | `assignedWorkerName` | `String` | Nullable | 被指派的维修工人姓名 | | `assignedWorkerPhone` | `String` | Nullable | 被指派的维修工人电话 | | `authorId` | `Int` | Foreign Key -> `User.id` | 提交报修单的业主ID | | `createdAt` | `DateTime` | Default `now()` | 创建时间 | | `updatedAt` | `DateTime` | Auto-update on change | 最后更新时间 |

### 2.3. `Evaluation` - 评价表

存储业主对已完成工单的评价。

| **字段名 (Field)** | **类型 (Type)** | **约束 (Constraints)** | **描述** | | `id` | `Int` | Primary Key, Auto-increment | 唯一ID | | `rating` | `Int` |  | 星级评分 (1-5) | | `comment` | `String` | Nullable | 文字评论 | | `orderId` | `Int` | Foreign Key -> `RepairOrder.id`, Unique | 对应的报修单ID (一个工单只能有一个评价) | | `authorId` | `Int` | Foreign Key -> `User.id` | 评价的提交者ID | | `createdAt` | `DateTime` | Default `now()` | 创建时间 |

### 2.4. `Favorite` - 收藏表

记录管理员关注的工单。

| **字段名 (Field)** | **类型 (Type)** | **约束 (Constraints)** | **描述** | | `id` | `Int` | Primary Key, Auto-increment | 唯一ID | | `adminId` | `Int` | Foreign Key -> `User.id` | 收藏该工单的管理员ID | | `orderId` | `Int` | Foreign Key -> `RepairOrder.id` | 被收藏的工单ID | | `createdAt` | `DateTime` | Default `now()` | 收藏时间 |

**复合唯一约束:** (`adminId`, `orderId`) 确保一个管理员对一个工单只能收藏一次。
